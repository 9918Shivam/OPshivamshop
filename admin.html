 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin | OP Electronics</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link href="style.css" rel="stylesheet" />
</head>
<body>

  <div class="container py-5">
    <a href="index.html" class="text-decoration-none d-block mb-3">
  <i class="bi bi-arrow-left"></i> Back to Home
</a>
    <h2 class="mb-4 text-center">Admin Panel</h2>

    <div id="loginSection" style="max-width:400px;margin:auto">
      <div class="mb-3">
        <label class="form-label">Email</label>
        <input type="email" id="adminEmail" class="form-control" placeholder="Enter email" />
      </div>
      <div class="mb-3">
        <label class="form-label">Password</label>
        <input type="password" id="adminPassword" class="form-control" placeholder="Enter password" />
      </div>
      <button class="btn btn-primary w-100 rounded-pill" id="adminLoginBtn">Login</button>
    </div>

    <div id="formSection" class="d-none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5>Add / Update Product</h5>
        <button class="btn btn-outline-danger btn-sm" onclick="localStorage.removeItem('ope_admin_logged_in'); location.reload();">Logout</button>
      </div>
      <div class="row g-3">
        <div class="col-md-6"><label class="form-label">Name</label><input type="text" id="prodName" class="form-control"></div>
        <div class="col-md-3">
          <label>Price (₹)</label>
          <input type="number" id="prodPrice" class="form-control" />
        </div>
        <div class="form-check mt-2">
          <input class="form-check-input" type="checkbox" id="showPriceChk">
          <label class="form-check-label" for="showPriceChk">
             Show price on homepage
            </label>
          </div>

        <div class="col-md-3">
          <label class="form-label" id="catLabel" style="cursor:pointer;">Category</label>
          <select id="prodCatSelect" class="form-select"></select>
          <input type="text" id="prodCatNew" class="form-control mt-2" placeholder="Or enter new category" />
        </div>
        
        <!-- <div class="col-md-3">
          <label>Category</label>
          <select id="prodCatSelect" class="form-select"></select>
          <input type="text" id="prodCatNew" class="form-control mt-2" placeholder="Or enter new category" />
        </div> -->
        <div class="col-12"><label class="form-label">Features</label><textarea id="prodFeatures" class="form-control" rows="2"></textarea></div>

        
        <div class="col-md-6">
          <label class="form-label">Image 1</label>
          <input type="url" id="prodImg1" placeholder="Paste image URL" class="form-control mb-1">
          <input type="file" accept="image/*" class="form-control" onchange="previewAndEncode(this, 'prodImg1')">
        </div>
        <div class="col-md-6">
          <label class="form-label">Image 2</label>
          <input type="url" id="prodImg2" placeholder="Paste image URL" class="form-control mb-1">
          <input type="file" accept="image/*" class="form-control" onchange="previewAndEncode(this, 'prodImg2')">
        </div>
        <div class="col-md-6">
          <label class="form-label">Image 3</label>
          <input type="url" id="prodImg3" placeholder="Paste image URL" class="form-control mb-1">
          <input type="file" accept="image/*" class="form-control" onchange="previewAndEncode(this, 'prodImg3')">
        </div>
        <div class="col-md-6">
          <label class="form-label">Image 4</label>
          <input type="url" id="prodImg4" placeholder="Paste image URL" class="form-control mb-1">
          <input type="file" accept="image/*" class="form-control" onchange="previewAndEncode(this, 'prodImg4')">
        </div>
        <div class="col-md-6">
          <label class="form-label">Image 5</label>
          <input type="url" id="prodImg5" placeholder="Paste image URL" class="form-control mb-1">
          <input type="file" accept="image/*" class="form-control" onchange="previewAndEncode(this, 'prodImg5')">
        </div>

        <div class="col-md-3">
          <label class="form-label">Primary Image #</label>
          <select id="prodPrimary" class="form-select">
            <option value="0">1</option>
            <option value="1">2</option>
            <option value="2">3</option>
            <option value="3">4</option>
            <option value="4">5</option>
          </select>
        </div>

        <div class="col-12 form-check mt-2">
          <input class="form-check-input" type="checkbox" id="prodBest">
          <label class="form-check-label">Mark as Best Seller</label>
        </div>
      </div>
      <button class="btn btn-success mt-3 rounded-pill" id="addProdBtn">Save Product</button>
      <hr>
      <h6>Current Products</h6>
      <ul class="list-group" id="productList"></ul>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
const API = "https://opelectronicshop.onrender.com";

let editingId = null;

// ===============================
// LOAD PRODUCTS
// ===============================
async function loadProducts() {
  try {
    const res = await fetch(API + "/products");

    if (!res.ok) {
      throw new Error("Server error while fetching products");
    }

    const products = await res.json();
    renderProducts(products);

  } catch (err) {
    console.error("Failed to fetch product list:", err);
    document.getElementById("productList").innerHTML =
      "<p class='text-danger'>Failed to load products</p>";
  }
}

// ===============================
// RENDER PRODUCTS
// ===============================
function renderProducts(products) {
  const container = document.getElementById("productList");
  container.innerHTML = "";

  if (!products.length) {
    container.innerHTML = "<p class='text-muted'>No products found</p>";
    return;
  }

  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "card p-3 mb-3";

    div.innerHTML = `
      <div class="d-flex justify-content-between">
        <div>
          <h6>${p.name}</h6>
          <small class="text-muted">${p.category}</small><br>
          ${p.showPrice ? `<strong>₹${p.price}</strong>` : ""}
        </div>
        <div>
          <button class="btn btn-sm btn-warning me-2" onclick="editProduct('${p._id}')">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteProduct('${p._id}')">Delete</button>
        </div>
      </div>
    `;
    container.appendChild(div);
  });
}

// ===============================
// SAVE / UPDATE PRODUCT
// ===============================
document.getElementById("productForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const product = {
    name: document.getElementById("name").value.trim(),
    price: document.getElementById("price").value.trim(),
    showPrice: document.getElementById("showPrice").checked,
    category: document.getElementById("category").value.trim(),
    features: document.getElementById("features").value.trim(),
    images: document.getElementById("images").value
              .split(",")
              .map(i => i.trim())
              .filter(Boolean),
    primary: 0
  };

  try {
    let res;

    if (editingId) {
      res = await fetch(API + "/products/" + editingId, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(product)
      });
    } else {
      res = await fetch(API + "/products", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(product)
      });
    }

    if (!res.ok) {
      throw new Error("Failed to save product");
    }

    alert(editingId ? "Product Updated" : "Product Added");

    editingId = null;
    document.getElementById("productForm").reset();
    loadProducts();

  } catch (err) {
    console.error("Save error:", err);
    alert("Error saving product");
  }
});

// ===============================
// EDIT PRODUCT
// ===============================
async function editProduct(id) {
  try {
    const res = await fetch(API + "/products");
    const products = await res.json();
    const p = products.find(x => x._id === id);
    if (!p) return;

    editingId = id;

    document.getElementById("name").value = p.name;
    document.getElementById("price").value = p.price;
    document.getElementById("showPrice").checked = p.showPrice;
    document.getElementById("category").value = p.category;
    document.getElementById("features").value = p.features;
    document.getElementById("images").value = (p.images || []).join(", ");

    window.scrollTo(0, 0);

  } catch (err) {
    console.error("Edit error:", err);
  }
}

// ===============================
// DELETE PRODUCT
// ===============================
async function deleteProduct(id) {
  if (!confirm("Delete this product?")) return;

  try {
    const res = await fetch(API + "/products/" + id, {
      method: "DELETE"
    });

    if (!res.ok) throw new Error("Delete failed");

    alert("Product deleted");
    loadProducts();

  } catch (err) {
    console.error("Delete error:", err);
    alert("Error deleting product");
  }
}

// ===============================
// INITIAL LOAD
// ===============================
document.addEventListener("DOMContentLoaded", loadProducts);
</script>

</body>
</html> 
